!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],function(a){return b()}):"undefined"!=typeof module&&module.exports?module.exports=b():window[a]=b()}("Datepicker",function(){"use strict";function a(c){var c=$.extend(a.DEFAULT,c);this.$container=$(c.container),this.initDate="string"==typeof c.initDate?new Date(c.initDate):c.initDate,this.startDate="string"==typeof c.startDate?new Date(c.startDate):c.startDate,this.endDate="string"==typeof c.endDate?new Date(c.endDate):c.endDate,this.initFrames=c.initFrame,this.restFrames=0,this.loadFrames=c.loadFrames,this.tmpYear=0,this.tmpMonth=0,this.loadOffset=c.loadOffset,this.singleFrame=c.singleFrame,this.i18n=c.i18n,this.selectCallback=c.selectCallback,this.dateJson=c.dateJson,this.dateString=JSON.stringify(this.dateJson);var d=this;if(!this.dateJson)throw"dateJson can not be empty! Please set the option item.";$(window).on("scroll",$.proxy(this.scrollLoad,this)),this.$container.on("click","span[data-date]",$.proxy(this.initEvents,this)),this.singleFrame&&this.$container.on("click","#prevBtn, #nextBtn",function(a){b.monthExchange(a.target,d.tmpYear||d.getInitYear()||d.getStartYear(),0!=d.tmpYear&&d.tmpMonth>=0?d.tmpMonth:d.getInitMonth()||d.getStartMonth(),d)}),this.init()}a.VERSION="1.0.0",a.DEFAULT={container:"",initDate:"",startDate:"",endDate:"",singleFrame:!1,initFrames:3,loadFrames:3,loadOffset:100,i18n:!1,dateJson:null,selectCallback:$.noop},a.prototype={constructor:a,init:function(){var a=this,c=this.singleFrame&&this.getInitYear()?this.getInitYear():this.getStartYear(),d=this.singleFrame&&this.getInitMonth()?this.getInitMonth():this.getStartMonth(),e=this.getEndYear(),f=this.getEndMonth();if(!(c>e||c==e&&d>f)){if(this.singleFrame||c==e&&d==f)return void this.$container.append(b.renderSinglePicker(c,d,a));if(!this.singleFrame)if(this.restFrames=12*(e-c)+f-d-this.initFrames,this.restFrames>0){var g=this.tmpYear=c+(d+this.initFrames>11?1:0),h=this.tmpMonth=(d+this.initFrames-1)%12;this.$container.append(b.renderMutiplePicker(c,d,g,h,a))}else this.$container.append(b.renderMutiplePicker(c,d,e,f,a))}},initEvents:function(a){var b="span"==a.target.tagName.toLowerCase()?$(a.target):$(a.target).parents("span");b.is(".is-outdate")||b.is(".is-today")||(this.$container.find(".selected").removeClass("selected"),b.addClass("selected"),this.initDate=new Date(b.data("date")),this.selectCallback.call(this,b.data("date")))},getInitYear:function(){return this.initDate.getFullYear()},getInitMonth:function(){return this.initDate.getMonth()},getStartYear:function(){return this.startDate.getFullYear()},getStartMonth:function(){return this.startDate.getMonth()},getEndYear:function(){return this.endDate.getFullYear()},getEndMonth:function(){return this.endDate.getMonth()},getEndDate:function(){return this.endDate},scrollLoad:function(){if(!(this.restFrames<=0)){var a,c,d=this,e=$(window),f=$(document),g=this.tmpYear,h=this.tmpMonth+1;f.height()-e.height()-e.scrollTop()<this.loadOffset&&(this.restFrames<=this.loadFrames?(this.restFrames=0,a=this.getEndYear(),c=this.getEndMonth(),this.$container.append(b.renderMutiplePicker(g,h,a,c,d))):(this.restFrames-=this.loadFrames,a=this.tmpYear=g+(h+this.loadFrames>11?1:0),c=this.tmpMonth=(h+this.loadFrames-1)%12,this.$container.append(b.renderMutiplePicker(g,h,a,c,d))))}}};var b={weeks:["日","一","二","三","四","五","六"],weeksi18n:["Sun","Mon","Tues","Wed","Thur","Fri","Sat"],months:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthsi18n:["January","February","March","April","May","June","July","August","September","October","November","December"],getCurrentDate:function(){return new Date},getMonthFirstDay:function(a,b){return new Date(a,b,1).getDay()},getMonthLastDay:function(a,b){return new Date(a,b+1,0).getDate()},formatDateString:function(a,b){var a="string"==typeof a?new Date(a):a,c=a.getFullYear(),d=parseInt(a.getMonth())+1,a=a.getDate();return c+b+(d>9?d:"0"+d)+b+(a>9?a:"0"+a)},formatDateObj:function(a){var a="string"==typeof a?new Date(a):a;return new Date(a.getFullYear()+"/"+(parseInt(a.getMonth())+1)+"/"+parseInt(a.getDate()))},fillArr:function(a,b){for(var c=this.getMonthFirstDay(a,b),d=this.getMonthLastDay(a,b),e=d,f=c+d>36?new Array(42):c+d>28?new Array(35):new Array(28),g=c,h=0;e>h;h++,g++)f[g]=a+"/"+(b+1)+"/"+(h+1);return f},getDateObj:function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.date==b)return d}},monthExchange:function(a,b,c,d){var e=$(a),f=e[0].className;-1==f.indexOf("disable-btn")&&(-1!=f.indexOf("prev-btn")&&(c-1>=0?function(){d.tmpYear=b,d.tmpMonth=c-1}():function(){d.tmpYear=b-1,d.tmpMonth=11}(),d.$container.empty().append(this.renderSinglePicker(d.tmpYear,d.tmpMonth,d))),-1!=f.indexOf("next-btn")&&(11>=c+1?function(){d.tmpYear=b,d.tmpMonth=c+1}():function(){d.tmpYear=b+1,d.tmpMonth=0}(),d.$container.empty().append(this.renderSinglePicker(d.tmpYear,d.tmpMonth,d))))},renderSinglePicker:function(a,b,c){var d=this.fillArr(a,b),e=this.getCurrentDate(),f=c.getEndDate(),g=c.initDate.getTime(),h=this.renderPickerHead(a,b,c);return h.append(this.renderPickerBody(d,e,f,g,c.dateJson,c.dateString))},renderPickerHead:function(a,b,c){var d=c.i18n?this.weeksi18n:this.weeks,e=c.i18n?this.monthsi18n[b]+" "+a:a+"年 "+this.months[b],f=c.singleFrame?'<i id="prevBtn" class="prev-btn '+(a==c.getStartYear()&&b==c.getStartMonth()?"disable-btn":"")+'">&lt;</i>':"",g=c.singleFrame?'<i id="nextBtn" class="next-btn '+(a==c.getEndYear()&&b==c.getEndMonth()?"disable-btn":"")+'">&gt;</i>':"",h=f+e+g,i=$('<div class="datepicker-table"><h2 id="dpHeader" class="datepicker-header">'+h+"</h2>"+function(){for(var a="",b=0;b<d.length;b++)a+='<span class="dp-th">'+d[b]+"</span>";return a}()+"</div>");return i},renderPickerBody:function(a,b,c,d,e,f){for(var g=this,h="",i=0;i<a.length;i++)void 0==a[i]?h+="<span></span>":function(i){var j=a[i].split("/"),k=parseInt(j[0]),l=parseInt(j[1])-1,m=parseInt(j[2]),n=g.formatDateString(a[i],"-"),o="",p=null;o+=new Date(a[i])<b||new Date(a[i])>c?"is-outdate ":"",o+=b.getFullYear()==k&&parseInt(b.getMonth())==l&&parseInt(b.getDate())==m?"is-today ":"",o+=-1!=o.indexOf("is-outdate")?"":-1!=o.indexOf("is-today")?"":new Date(a[i]).getTime()==d?"selected":"",o+=f.indexOf(n)>-1?" has-quota":"",p=o.indexOf("has-quota")>-1?g.getDateObj(e,n):null,o+=o.indexOf("has-quota")>-1&&parseInt(p.quota)>0?" is-quota-valid":"",(i%7==0||i%7==6)&&(o+=" is-weekend"),h+='<span class="'+o+'" data-date="'+a[i]+'"><i>'+m+"</i>"+(o.indexOf("has-quota")>-1?'<em class="datepicker-price">'+p.currency+p.price+'</em><em class="datepicker-quota">库存'+p.quota+"</em>":"")+"</span>"}(i);return h},renderMutiplePicker:function(a,b,c,d,e){for(var f=c-a,g=12*f+d-b,h=$("<div/>"),i=0;g>=i;i++){var j=(b+i)%12,k=b+i>=12?a+1:a;h.append(this.renderSinglePicker(k,j,e))}return h}};return a});